%-------------------------------------------------------------------------------
% This is the file bapcbase.sty.
%
% This code implements the basic features mandated by the problem package specification:
% https://www.kattis.com/problem-package-format/spec/2025-09.html#latex-environment-and-supported-subset
% To use this package, you must implement the following macros:
%   \InteractiveSampleHeading
%   \InteractiveRead{<path>}
%   \InteractiveWrite{<path>}
%   \InteractivePass{<pass id>}
%   \MultipassSampleHeading
%   \SamplePass{<pass id>}{<in path>}{<ans path>}
%   \Sample{<in path>}{<ans path>}
%   \ProblemHeading{<name>}
% Note that BAPCtools' default document class bapc.cls uses this package and defines all of the required macros.
%-------------------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{bapcbase}[2026/01/01 Base LaTeX class for ICPC problem statements that get built with BAPCtools]

%-------------------------------------------------------------------------------
% Localization
% The tooling should define this using pretex
%-------------------------------------------------------------------------------
\providecommand{\lang}{en}
\input{lang/\lang.tex}
\let\sffamilyFB\sffamily% Prevent error if babel fr loads \sffamilyFB in cache
\let\ttfamilyFB\ttfamily
\let\rmfamilyFB\rmfamily
\RequirePackage[\langbabel]{babel}

%-------------------------------------------------------------------------------
% Additional commands redefined by the contest-problem.tex
%-------------------------------------------------------------------------------
\newcommand{\timelimit}{\langtimelimitmissing{}}
\newcommand{\problemlabel}{}
\newcommand{\problemyamlname}{\langproblemname{}}
\newcommand{\problemauthor}{\langproblemauthor{}}
\newcommand{\fullproblemtitle}{\problemlabel: \problemyamlname}

%-------------------------------------------------------------------------------
% Additional packages required by the problem spec
%-------------------------------------------------------------------------------
\RequirePackage{listingsutf8}
\RequirePackage{graphicx}

%-------------------------------------------------------------------------------
% Command to automatically include samples in order.
% The tooling has to define the commands \Sample1{},...\Sample<n>{}
%-------------------------------------------------------------------------------
\newcounter{NextSample}

\newcommand{\nextsample}{%
	\expandafter\csname Sample\theNextSample\endcsname%
	\expandafter\let\csname Sample\theNextSample\endcsname\undefined%
	\stepcounter{NextSample}%
}

\newcommand{\remainingsamples}{%
	\ifcsname Sample\theNextSample\endcsname%
		\nextsample%
		\remainingsamples%
	\fi%
}
% To use this command, you must implement the following macros:
%   \InteractiveSampleHeading
%   \InteractiveRead{<path>}
%   \InteractiveWrite{<path>}
%   \InteractivePass{<pass id>}
%   \MultipassSampleHeading
%   \SamplePass{<pass id>}{<in path>}{<ans path>}
%   \Sample{<in path>}{<ans path>}

%-------------------------------------------------------------------------------
% Define problemname command and reset internal counters
%-------------------------------------------------------------------------------
\newcommand{\problemname}[1]{
	\setcounter{NextSample}{1}
	\ifblank{#1}{\ProblemHeading{\problemyamlname}}{\ProblemHeading{#1}}
}
% To use this command, you must implement the following macro:
%   \ProblemHeading{<name>}

%-------------------------------------------------------------------------------
% Environments for specifying Input, Output and Interaction
% you may want to override these
%-------------------------------------------------------------------------------
\newenvironment{Input}{
	\subsection*{\langinput{}}
}{\par}
\newenvironment{Output}{
	\subsection*{\langoutput{}}
}{\par}
\newenvironment{Interaction}{
	\subsection*{\langinteraction{}}
}{\par}
\newenvironment{Explanation}{
	\subsection*{\langexplanation{}}
}{\par}

%-------------------------------------------------------------------------------
% Command to include illustaration.
% you may want to override this
%-------------------------------------------------------------------------------
\RequirePackage{wrapfig}
\newcommand{\illustration}[3]{
	\begin{wrapfigure}{r}{#1\textwidth}
		\includegraphics[width=#1\textwidth]{#2}

		\begin{flushright}
			\tiny\strut{}#3
		\end{flushright}
	\end{wrapfigure}
}

%-------------------------------------------------------------------------------
% Command to include constants.
% The tooling has to define the commands \constants_<key>{}
%-------------------------------------------------------------------------------
\newcommand{\constant}[1]{%
	\ifcsname constants_#1\endcsname%
		\csname constants_#1\endcsname%
	\else%
		\PackageError{constants}{constant{#1} is not defined}{}%
	\fi%
}
